<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Classroom Display - WebSocket Test</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body {

      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;

      margin: 30px auto;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1 {
      color: #4ec9b0;
      margin-bottom: 30px;
    }
    .section {
      background: #252526;
      padding: 20px;
      margin: 15px 0;
      border-radius: 8px;
      border: 1px solid #3e3e42;
    }

    .section h3 {
      color: #569cd6;
      margin-top: 0;
    }

    .status-bar {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    .status {
      display: inline-block;
      padding: 8px 15px;
      border-radius: 5px;
      font-weight: bold;

      margin-left: 15px;
    }
    .connected {
      background: #4ec9b0;
      color: #1e1e1e;
    }
    .disconnected {
      background: #f48771;
      color: #1e1e1e;
    }
    .connecting {
      background: #dcdcaa;

      color: #1e1e1e;
    }
    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    input {
      padding: 10px 15px;
      border-radius: 5px;
      border: 1px solid #555;
      background: #3c3c3c;
      color: #d4d4d4;
      font-size: 14px;
      min-width: 200px;
    }
    input:focus {
      outline: none;
      border-color: #0e639c;
    }
    button {
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-primary {
      background: #0e639c;
      color: white;
    }
    .btn-primary:hover {
      background: #1177bb;
    }
    .btn-primary:active {
      background: #0d5282;
    }
    .btn-danger {
      background: #f48771;
      color: #1e1e1e;
    }
    .btn-danger:hover {

      background: #ff6b4a;
    }
    .btn-secondary {
      background: #555;
      color: white;
    }
    .btn-secondary:hover {
      background: #666;
    }
    .log {
      background: #1e1e1e;
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #3e3e42;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
    }
    .log-entry {
      margin: 5px 0;
      padding: 3px 0;
    }
    .log-time {

      color: #858585;
    }
    .log-success {
      color: #4ec9b0;
    }
    .log-error {

      color: #f48771;
    }
    .log-info {
      color: #d4d4d4;
    }
    .log-warning {
      color: #dcdcaa;
    }
    .info-box {
      background: #264f78;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
      border-left: 4px solid #569cd6;
    }
    .info-box strong {
      color: #569cd6;
    }
  </style>
</head>
<body>

  <h1>üñ•Ô∏è Classroom Display - WebSocket Test Client</h1>

  <!-- Status Section -->
  <div class="section">
    <h3>Connection Status</h3>
    <div class="status-bar">
      <strong>Status:</strong>
      <span id="status" class="status disconnected">DISCONNECTED</span>
    </div>
    <div id="connectionInfo" class="info-box" style="display: none;">
      <strong>Socket ID:</strong> <span id="socketId">-</span><br>
      <strong>Namespace:</strong> <span id="namespace">-</span><br>
      <strong>Classroom:</strong> <span id="classroom">-</span>
    </div>
  </div>

  <!-- Controls Section -->
  <div class="section">
    <h3>Connection Controls</h3>
    <div class="controls">
      <input 
        id="classroomInput" 
        type="text" 
        placeholder="Enter classroom code (e.g., AH302, EL304)"
        value="AH302"
      >
      <button class="btn-primary" onclick="connect()">Connect</button>
      <button class="btn-danger" onclick="disconnect()">Disconnect</button>
    </div>
  </div>

  <!-- Activity Log Section -->
  <div class="section">
    <h3>Activity Log</h3>
    <button class="btn-secondary" onclick="clearLog()">Clear Log</button>
    <div class="log" id="log"></div>
  </div>


  <script>
    let socket = null;
    let currentClassroom = null;

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const typeClass = `log-${type}`;
      
      const entry = document.createElement('div');
      entry.className = 'log-entry';

      entry.innerHTML = `<span class="log-time">[${timestamp}]</span> <span class="${typeClass}">${message}</span>`;
      
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
      log('Logs cleared', 'info');
    }

    function updateStatus(text, state) {
      const statusEl = document.getElementById('status');
      statusEl.textContent = text;
      statusEl.className = `status ${state}`;
    }

    function updateConnectionInfo(show, socketId = '-', namespace = '-', classroom = '-') {
      const infoBox = document.getElementById('connectionInfo');
      if (show) {
        document.getElementById('socketId').textContent = socketId;
        document.getElementById('namespace').textContent = namespace;
        document.getElementById('classroom').textContent = classroom;
        infoBox.style.display = 'block';
      } else {
        infoBox.style.display = 'none';
      }
    }

    function connect() {
      if (socket && socket.connected) {
        log('‚ö†Ô∏è Already connected to ' + currentClassroom, 'warning');
        return;
      }

      const classroom = document.getElementById('classroomInput').value.trim().toUpperCase();
      
      if (!classroom) {
        log('‚ùå Please enter a classroom code', 'error');
        return;
      }

      // Validate format (letters followed by numbers)
      if (!/^[A-Z]+\d+$/.test(classroom)) {

        log('‚ùå Invalid classroom format. Use format like: AH302, EL304, BT205', 'error');
        return;
      }

      currentClassroom = classroom;
      const url = `http://localhost:3000/screens/${classroom}`;
      
      log(`üîÑ Connecting to: ${url}`, 'info');
      updateStatus('CONNECTING...', 'connecting');


      socket = io(url, {
        transports: ['websocket', 'polling'],
        reconnection: true,

        reconnectionDelay: 1000,
        reconnectionAttempts: 5,
      });

      // Connection events
      socket.on('connect', () => {
        log(`‚úÖ CONNECTED to classroom ${currentClassroom}!`, 'success');
        log(`   Socket ID: ${socket.id}`, 'success');
        updateStatus(`CONNECTED (${currentClassroom})`, 'connected');
        updateConnectionInfo(true, socket.id, `/screens/${currentClassroom}`, currentClassroom);
      });

      socket.on('disconnect', (reason) => {
        log(`‚ùå Disconnected from ${currentClassroom}`, 'error');
        log(`   Reason: ${reason}`, 'error');
        updateStatus('DISCONNECTED', 'disconnected');
        updateConnectionInfo(false);
      });

      socket.on('connect_error', (error) => {
        log(`‚ùå Connection Error: ${error.message}`, 'error');
        log('   Make sure server is running on http://localhost:3000', 'error');
        updateStatus('CONNECTION FAILED', 'disconnected');
        updateConnectionInfo(false);
      });

      socket.on('reconnect_attempt', (attemptNumber) => {
        log(`üîÑ Reconnection attempt #${attemptNumber}...`, 'warning');
        updateStatus('RECONNECTING...', 'connecting');
      });

      socket.on('reconnect', (attemptNumber) => {
        log(`‚úÖ Reconnected after ${attemptNumber} attempts`, 'success');
      });

      socket.on('reconnect_failed', () => {
        log(`‚ùå Reconnection failed after all attempts`, 'error');
        updateStatus('RECONNECTION FAILED', 'disconnected');
      });

      // Application events
      socket.on('updateSchedule', (data) => {
        log(`üìÖ SCHEDULE UPDATE RECEIVED`, 'success');

        log(`   Classroom: ${data.classroom}`, 'info');
        if (data.classes && data.classes.length > 0) {
          log(`   Classes: ${data.classes.length}`, 'info');
          data.classes.forEach((cls, idx) => {
            log(`   ${idx + 1}. ${cls.courseCode}: ${cls.courseTitle}`, 'info');
            log(`      ${cls.instructor} | ${cls.startTime}-${cls.endTime}`, 'info');
          });

        }
      });

      socket.on('announcement', (data) => {

        log(`üì¢ ANNOUNCEMENT: ${JSON.stringify(data)}`, 'warning');
      });


      socket.on('error', (data) => {
        log(`‚ùå ERROR: ${data.message || JSON.stringify(data)}`, 'error');
      });

    }

    function disconnect() {
      if (!socket) {

        log('‚ö†Ô∏è Not connected', 'warning');
        return;
      }

      log(`üîå Disconnecting from ${currentClassroom}...`, 'info');
      socket.disconnect();
      socket = null;
      currentClassroom = null;
      updateStatus('DISCONNECTED', 'disconnected');
      updateConnectionInfo(false);
    }


    // Allow Enter key to connect
    document.getElementById('classroomInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        connect();
      }
    });

    // Initial log
    window.onload = () => {
      log('üöÄ Test client loaded', 'info');
      log('üìù Enter a classroom code (e.g., AH302, EL304) and click "Connect"', 'info');
    };

  </script>

</body>
</html>
